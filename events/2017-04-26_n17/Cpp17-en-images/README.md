C++17 en images
===============

Copyright 2017 Oliver H &emsp; [CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/deed.fr)

[![le logo C++FRUG est consitué du drapeau de la francophonie avec C++ au centre](http://cpp-frug.github.io/images/Cpp-Francophonie.svg "Logo C++FRUG")](https://github.com/cpp-frug/cpp-frug.github.io/blob/master/images/Cpp-Francophonie.svg)

[cppfrug.org/paris/events/2017-04-26_n17/Cpp17-en-images](http://cpp-frug.github.io/paris/events/2017-04-26_n17/Cpp17-en-images/)

[github.com/cpp-frug/paris/events/2017-04-26_n17/Cpp17-en-images](https://github.com/cpp-frug/paris/blob/master/events/2017-04-26_n17/Cpp17-en-images/README.md)


C'était mieux avant ?
---------------------

[![Évolution du langage C++](https://cpp-frug.github.io/materials/images/cpp-evolution-path.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-evolution-original.svg)


C++ a une quarantaine d'années
------------------------------

* 1977 &emsp; Bjarn rêve au **C with classes**
* 1990 &emsp; Schisme entre **C** et **C++**
* 1998 &emsp; Premier standard --> **C++98**
* 2017 &emsp; Cinquième standard --> **C++17**


C++17 c'est un gros pavé
------------------------

[![Deux collègues contents de la sortie de C++17 mais qui ils ne sont pas au courant des Meetups C++FRUG qui leur permettrait de cerner les nouvelles fonctionnalités.](http://cpp-frug.github.io/materials/images/cpp-complexe-cppfrug.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-complexe-cppfrug.svg)


C++17 ajoute 220 pages
----------------------

Date      | ISO/IEC ou Draft                                                                                         | Pages
--------- | -------------------------------------------------------------------------------------------------------- | -------
1998-09-01|C++98 [14882:1998](http://www.lirmm.fr/~ducour/Doc-objets/ISO+IEC+14882-1998.pdf)                         |  776 pages
2003-10-15|C++03 [14882:2003](https://github.com/hstefan/htlib/blob/master/res/INCITS%2BISO%2BIEC%2B14882-2003.pdf)  |  786 pages (+ 1%)
2011-09-01|C++11 [14882:2011](http://new.vk.com/doc100509572_160085962?hash=6801602629449dfa59&dl=27c32949114b3322a2)| 1356 pages (+73%)
2012-02-28|C++11 [N3376](http://open-std.org/JTC1/SC22/WG21/docs/papers/2012/n3376.pdf)                              | 1324 pages
2014-11-19|C++14 [N4296](http://open-std.org/JTC1/SC22/WG21/docs/papers/2014/n4296.pdf)                              | 1368 pages (+ 3%)
2016-11-28|C++17 [N4618](http://open-std.org/JTC1/SC22/WG21/docs/papers/2016/n4618.pdf)                              | 1587 pages (+16%)



2016 : Deux réunions pour figer le périmètre du C++17
-----------------------------------------------------

Photo d'Oulu prise par Loïc Joly pendant la réunion ISO C++.  
Elle a été prise à 23h, en plein centre ville.

[![Oulu à 23h](https://photos.google.com/share/AF1QipPqyOA5p8nbXZa6cro5YkrdtJcfCRAcKKL4O2Jbvcv8hWIIm-AbsDFEkxfZRzsryA/photo/AF1QipN-rZBPmW4qPEQ_XhzD_xN_wnimWf1Kj-q6VecF?key=VVdJSnF6SWFuMFdBZVNXSDRLcmk0NVpJbE43UFJR)](https://goo.gl/photos/Fb6RYRfYj4pymtCk7)

https://photos.google.com/share/AF1QipPqyOA5p8nbXZa6cro5YkrdtJcfCRAcKKL4O2Jbvcv8hWIIm-AbsDFEkxfZRzsryA/photo/AF1QipN-rZBPmW4qPEQ_XhzD_xN_wnimWf1Kj-q6VecF?key=VVdJSnF6SWFuMFdBZVNXSDRLcmk0NVpJbE43UFJR


Les *Concepts* et *Reflexion* étaient très attendues
----------------------------------------------------

[![Deux chatons tristes que Concepts et Reflexion n'aient pas été intégrées à C++17](http://cpp-frug.github.io/materials/images/cpp-chatons-tristes_copyright-Ziyue-OliverH-2016_CC-BY-SA-3.jpg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-chatons-tristes_copyright-Ziyue-OliverH-2016_CC-BY-SA-3.jpg)


Les *Modules* n'en font pas partis non plus
-------------------------------------------

[![Bjarn et les Modules en 2003](http://cpp-frug.github.io/materials/images/cpp-concepts-bjarne-path.2003.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-concepts-bjarne-path.2003.svg)


[![Bjarn et les Modules en 2011](http://cpp-frug.github.io/materials/images/cpp-concepts-bjarne-path.2011.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-concepts-bjarne-path.2011.svg)


[![Bjarn et les Modules en 2014](http://cpp-frug.github.io/materials/images/cpp-concepts-bjarne-path.2014.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-concepts-bjarne-path.2014.svg)


[![Bjarn et les Modules en 2017](http://cpp-frug.github.io/materials/images/cpp-concepts-bjarne-path.2017.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-concepts-bjarne-path.2017.svg)


[![Bjarn et les Modules en 20xx](http://cpp-frug.github.io/materials/images/cpp-concepts-bjarne-path.20xx.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-concepts-bjarne-path.20xx.svg)


Un air de promesses électorales
-------------------------------

[![C++17 président](http://cpp-frug.github.io/materials/images/cpp-president-2017.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp-president-2017.svg)


C++17 = Dépoussièrer le standard C++
====================================


Ordre d'évaluation
------------------

[![On modifie le C++ pour corriger le livre de Bjarn](http://cpp-frug.github.io/materials/images/cpp17-bjarne-ordre-evaluation.png)](https://github.com/cpp-frug/materials/blob/gh-pages/images/cpp17-bjarne-ordre-evaluation.png)





<!--
C++17/20/23 dès aujourd'hui
---------------------------

Les [***feature testing macros***](http://en.cppreference.com/w/User:D41D8CD98F/feature_testing_macros) permettent d'écrire du code  
qui s'adapte aux fonctionnalités prises en charge   
par le compilateur et sa bibliotèque standard `std::`

```cpp
#ifdef __cpp_lib_experimental_filesystem
#include <filesystem>
void backup()
{
  std::filesystem::copy("file.txt","file.bak");
}
#else
void backup()
{
  /* ... */
}
#endif
```

* `__cpp_concept` (déjà pris en charge par GCC)
* `__cpp_lib_filesystem` (`_lib_` identifie une fonctionnalité de la `std::`)
* Correspond à la [date comme `2015'01`](en.cppreference.com/w/cpp/experimental/feature_test#Language_Features) selon la publication de la TS


Alternatives aux *feature testing macros*
----------------------------------------

* Macro `__cplusplus`  
  Valeurs `201103`, `201402` et bientôt `2017xx`  
  Ou bien `2011'03`, `2014'02` et `2017'00`  
  Juste bien pour détecter le flag `-std=c++14`  
  
* Macros [**Boost.Config**](http://www.boost.org/doc/libs/1_61_0/libs/config/doc/html/boost_config/boost_macro_reference.html)  

* [**`CMAKE_CXX_KNOWN_FEATURES`**](https://cmake.org/cmake/help/latest/prop_gbl/CMAKE_CXX_KNOWN_FEATURES.html)  
  CMake connait les fonctionnalités C++ du compilateur
        
    ```cmake
    target_compile_features(MyLib PRIVATE cxx_constexpr)
    ```
* Macro `__has_include`  


`__has_include()`
----------------

[**P0061**](https://wg21.link/p0061) ajoute la macro [**`__has_include()`**](http://en.cppreference.com/w/cpp/preprocessor/include)  
=> vérifie la présence d'un *header* à la compilation

```cpp
#ifdef __has_include
# if   __has_include(<filesystem>)
#            include <filesystem>
# elif __has_include(<experimental/filesystem>)
#            include <experimental/filesystem>
# elif __has_include(<boost/filesystem.hpp>)
#            include <boost/filesystem.hpp>
# else
#  error  Cannot find any 'filesystem' header
#else
# include <boost/filesystem.hpp>
#endif
```

-->

Virgule flottante en hexadécimal
--------------------------------
    
[**P0245**](http://wg21.link/p0245) officialise les ***hexadecimal floating literals*** (comme pour C99, Java 5 2004)
    
```cpp
float  v = 0x'Baffe.bobo'p1f;
double w = 0x'C0DE'2017'1.cafe'p1;
``` 
    
[![Les Nerdettes s’entraînent pour le concours des littéraux hexadécimaux sur LinuxFr.org](https://cpp-frug.github.io/materials/images/nerdettes_litteral_hexa.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/nerdettes_litteral_hexa.svg)


<!--
Concours de jeux de mots
------------------------

[Attention, le concours se termine fin janvier !](http://linuxfr.org/news/attention-le-concours-de-jeux-de-mots-se-termine-fin-janvier-2017)

[![Les deux filles nerds discutent sur la manipulation des bits au grand bonheur des jeux de mots](https://cpp-frug.github.io/materials/images/nerd_jeux-de-mots.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/nerd_jeux-de-mots.svg)



`if constexpr`
-------------

[**P0292**](https://wg21.link/p0292) simplifie la métaprogrammation avec  
`static_if` ... `constexpr_if` ... `constexpr if`  
... et finalement `if constexpr`
  
```cpp
template <class T, class... R>
void fonction (const T& t, const R&... r)
{
  std::cout << t;    // Gère un argument
  if constexpr (sizeof...(r))
    fonction(r...);  // Gère le reste
  else
    std::cout << std::endl;
}
```
-->

Variable `inline` ([P0386](http://wg21.link/p0386))
----------------------------------------------------

* Après les variables `template` (C++14)
* Fin du [***One Definition Rule***](https://en.wikipedia.org/wiki/One_Definition_Rule) ?

[![Les deux filles nerds résolvent une erreur de link d'une variable membre static non définie en rajoutant inline](https://cpp-frug.github.io/materials/images/nerd_cpp17_variable_inline.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/nerd_cpp17_variable_inline.svg)

<!--

Structured bindings
-------------------

[P0217](https://wg21.link/p0217) apporte la **décomposition du retour de fonction**,  
mais limitée aux `std::tuple`, aux tableaux (`std::array`)  
et aux structures plates (`std::pair`)
    
```cpp
struct A
{
  int  a;
  bool b;
  char c;
};

A foo()
{
  return A{42, true, 'c'};
}

auto [ x, y, ignored ] = foo();
``` 
    
* Mieux que `std::tie` (cantonné aux `std::tuple` et à `std::pair`)
* Mais pas de `std::ignore`


`if(init;condition)` et `switch(init;condition)`
-----------------------------------------------

[P0305](wg21.link/p0305) ajoute les *instructions de sélection avec initialiseur*  
comme `for(init; condition; incrément)`

```cpp
if (auto [it, inserted] = mySet.insert(value); inserted)
{
  foo(it);
}

switch (bool loop=true; loop)
{
  /* ... */
  loop = false;
  /* ... */
}
```
-->

`auto x{42};` déduit comme `int x{42};`
-------------------------------------

[N3922](https://wg21.link/n3922) comble un trou dans les règles de déduction pour `auto` à partir des `{`listes d'initialisation`}`
    
```cpp
auto a   {1};     //ok => int a{1};
auto b = {1};     //ok => std::initializer_list<int> b = {1};
    
auto c   {1, 2};  //KO car plus d'un élément
auto d = {1, 2};  //ok => std::initializer_list<int> d = {1, 2};
    
auto e   {1, 2.0}; //KO car plus d'un élément
auto f = {1, 2.0}; //KO car pas le même type (int et double)
``` 
    
[![Une écolière écrit une boucle for en C++17 pour régler sa punition d'écrire 100 fois "Je ne dois pas envoyer d'avion en papier"](http://cpp-frug.github.io/materials/images/cpp-ecole-primaire_copyright-Ziyue-OliverH-2016_CC-BY-SA-3_auto.jpg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/README.md#c17-sauve-une-%C3%A9coli%C3%A8re)


<!--
`typename` pour les paramètres `template template`
-------------------------------------------------

[N4051](https://wg21.link/n4051) autorise enfin `typename` pour les paramètres `template template`

```cpp
template<template<typename> class    T> class Cpp98;
template<template<typename> typename T> class Cpp17;
```


C++ without `class`
-------------------

Le nom originel du C++ était ***C with `class`***.  
Avec [N4051](https://wg21.link/n4051), le C++17 devient le ***C++ without `class`***.

```cpp
template <class T, template<class> C>
class AvecClass : C<T>
{
    int v;
};
    
template <typename T, template<typename> C>
struct SansClass : private C<T>
{
private:
    int v;
};
```
-->


Suppression des trigraphes
--------------------------

C++11 aurait pu rendre les trigraphes obsolètes.  
Mais quelques membres du comité C++ s'y étaient opposés (IBM, Bloomberg).  
Pour C++17, les membres ont finalement voté [N4086](https://wg21.link/n4086)  
qui les supprime directement sans passer par l'étape *deprecated*.

```cpp
/??/
/??/ Avec trigraphes
??=include <iostream>
int main (int argc, char *argv??(??)) ??< 
  const char txt??(??) = "J'aime le C++17??/0";
  std::cout << txt << std::endl;
??>
``` 
    
```cpp
/\
/\ Sans trigraphe
#include <iostream>
int main (int argc, char *argv[]) {
  const char txt[] = "J'aime le C++17";
  std::cout << txt << std::endl;
}
```


Apple ][ (1977-1988)
--------------------

Aucune touche ne dispose du symbole *accolade* ou *crochet*.

[![Image du clavier de l'Apple II qui n'a pas de touche avec accolade ou crochet](https://upload.wikimedia.org/wikipedia/commons/thumb/2/21/Apple_II-IMG_7073.jpg/1024px-Apple_II-IMG_7073.jpg)](https://commons.wikimedia.org/wiki/File:Apple_II-IMG_7073.jpg)


BBC Master (1986-1994)
----------------------

Le clavier intégré du micro-ordinateur 8 bits BBC Master de Acorn indique les *crochets* mais pas les *accolades*.

[![Clavier intégré du micro-ordinateur BBC Master de Acorn](https://upload.wikimedia.org/wikipedia/commons/6/60/Acorn_BBC_Master_Series.jpg "Micro-ordinateur BBC Master de Acorn (8-bit avec clavier intégré) fabriqué entre 1986 et 1994")](https://en.wikipedia.org/wiki/BBC_Master)

<!--

Suppression du mot-clé `register`
--------------------------------

> Historiquement, le mot-clé [`register`](http://en.cppreference.com/w/c/keyword/register) aidait le compilateur à identifier la variable à conserver dans un registre du processeur (les compilateurs n'étaient pas très futés...)
>
> * **C++11** déprécie `register`  
>   (conservé pour compatibilité avec le C)
>
> * **C++17** résèrve `register` pour un autre usage futur  
>   (trop compliqué de résoudre les différences avec le C)


Booléen non incrémentable
-------------------------

La spécification initiale de `bool` ne devait pas trop casser le bon vieux code C/C++.
    
* décrémentation interdite
* incrémentation autorisée
    
    ```c
    #define bool int
    ```

Maintenant, l'incrémentation devient également interdite.

```cpp
bool b = foo();
--b; // Erreur depuis C++98
++b; // Erreur depuis C++17
```

-->

Fonctions libres
----------------

[![Les fonctions empty, data() et size() sortent de la prison "class" et rejoignent les fonctions begin() et end() qui les accueillent. Ces deux dernières fonctions accueillent également string_view. Derrières les barreaux de la prison des spécifications techniques, Unified-Call-Syntax va devoir y rester trois ans pour tenter de sortir avec C++20](http://cpp-frug.github.io/materials/images/fonctions_libres.svg)](https://github.com/cpp-frug/materials/blob/gh-pages/images/README.md#les-fonctions-libres)
